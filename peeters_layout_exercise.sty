%-----------------------------------------------------------------------------------

\RequirePackage{exercise}
\RequirePackage{mdframed}

   %-----------------------------------------------------------------------------------
   % remove the centerline that we have in exercise.sty
   % and add some color.  and add chapter numbers.
   %
   %\renewcommand{\ExerciseHeader}{\leftline{\textbf{\large\color{DarkOliveGreen}{\ExerciseName\ \thechapter.\ExerciseHeaderNB} \color{Maroon}{\ExerciseHeaderTitle}\ExerciseHeaderOrigin\medskip}}}
   %\renewcommand{\AnswerHeader}{\medskip\leftline{\textbf{\color{Maroon}{Answer for \ExerciseName}\ \color{DarkOliveGreen}{\thechapter.\ExerciseHeaderNB}}\smallskip}}
   %-----------------------------------------------------------------------------
   % Better: chapter numbers within exersize counters.  Let the chngcntr package do the work (it also works properly across a chapter boundary)
   % http://tex.stackexchange.com/questions/27444/number-exercises-according-to-chapter
   %
   %\RequirePackage{chngcntr}
   %\newcounter{Example}
   %\counterwithin{Example}{chapter}
   %\counterwithin{Exercise}{chapter}
   %\counterwithin{Answer}{chapter}
   %-----------------------------------------------------------------------------
   % use of chngcntr as above worked fine until I started using Examples.  Here's the issue and solution:
   %
   % http://tex.stackexchange.com/questions/56927/help-with-exercise-sty-counter-not-shown-incremented#56933
   \renewcounter{Exercise}[chapter]
   \makeatletter
   \renewcommand{\theExercise}{\if@ExeStared\else\thechapter.\arabic{\@ExerciseCounter}\fi}
   \makeatother
   \newcounter{Example}
   \renewcounter{Example}[chapter]
   %-----------------------------------------------------------------------------
   % removed \large.  It made the problem header larger than the section headings.
   %\renewcommand{\ExerciseHeader}{\leftline{\textbf{\large\color{DarkOliveGreen}{\ExerciseName\ \ExerciseHeaderNB} \color{Maroon}{\ExerciseHeaderTitle}\ExerciseHeaderOrigin\medskip}}}

   % with boldface: 
   %\renewcommand{\ExerciseHeader}{\leftline{\textbf{\color{DarkOliveGreen}{\ExerciseName\ \ExerciseHeaderNB} \color{Maroon}{\ExerciseHeaderTitle}\ExerciseHeaderOrigin\medskip}}}
   %\renewcommand{\AnswerHeader}{\medskip\leftline{\textbf{\color{Maroon}{Answer for \ExerciseName}\ \color{DarkOliveGreen}{\ExerciseHeaderNB}}\smallskip}}

   % no boldface:
   \renewcommand{\ExerciseHeader}{\leftline{\color{DarkOliveGreen}{\ExerciseName\ \ExerciseHeaderNB} \color{Maroon}{\ExerciseHeaderTitle}\ExerciseHeaderOrigin\medskip}}
   \renewcommand{\AnswerHeader}{\medskip\leftline{\color{Maroon}{Answer for \ExerciseName}\ \color{DarkOliveGreen}{\ExerciseHeaderNB}\smallskip}}
   %-----------------------------------------------------------------------------

%-----------------------------------------------------------------------------------

\newcounter{theorem}
\numberwithin{theorem}{chapter}
\newenvironment{theorem}[1][]{%
  \refstepcounter{theorem}%
  \ifstrempty{#1}%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Theorem}~\thetheorem};}}
  }%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Theorem}~\thetheorem:~\color{Maroon}{#1}};}}%
  }%
  \mdfsetup{innertopmargin=10pt,linecolor=DarkOliveGreen,%
            linewidth=1pt,topline=true,%
            frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
  \begin{mdframed}[]\relax%
  }{\end{mdframed}}

\newcommand{\maketheorem}[3]{%
\begin{theorem}[#1]\label{#2}%
#3%
\end{theorem}%
}

%\crefname{theorem}{theorem}{theorems} 
%\Crefname{theorem}{Theorem}{Theorems} 

%-----------------------------------------------------------------------------------

\newcounter{axiom}
\numberwithin{axiom}{chapter}
\newenvironment{axiom}[1][]{%
  \refstepcounter{axiom}%
  \ifstrempty{#1}%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Axiom}~\theaxiom};}}
  }%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Axiom}~\theaxiom:~\color{Maroon}{#1}};}}%
  }%
  \mdfsetup{innertopmargin=10pt,linecolor=DarkOliveGreen,%
            linewidth=1pt,topline=true,%
            frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
  \begin{mdframed}[]\relax%
  }{\end{mdframed}}

\newcommand{\makeaxiom}[3]{%
\begin{axiom}[#1]\label{#2}%
#3%
\end{axiom}%
}

%\crefname{axiom}{axiom}{axioms} 
%\Crefname{axiom}{Axiom}{Axioms} 

%-----------------------------------------------------------------------------------
\newcounter{lemma}
\numberwithin{lemma}{chapter}
\newenvironment{lemma}[1][]{%
  \refstepcounter{lemma}%
  \ifstrempty{#1}%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Lemma}~\thelemma};}}
  }%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Lemma}~\thelemma:~\color{Maroon}{#1}};}}%
  }%
  \mdfsetup{innertopmargin=10pt,linecolor=DarkOliveGreen,%
            linewidth=1pt,topline=true,%
            frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
  \begin{mdframed}[]\relax%
  }{\end{mdframed}}

\newcommand{\makelemma}[3]{%
\begin{lemma}[#1]\label{#2}%
#3%
\end{lemma}%
}

%\crefname{lemma}{lemma}{lemmas} 
%\Crefname{lemma}{Lemma}{Lemmas} 
%-----------------------------------------------------------------------------------

\newcounter{definition}
\numberwithin{definition}{chapter}
\newenvironment{definition}[1][]{%
  \refstepcounter{definition}%
  \ifstrempty{#1}%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Definition}~\thedefinition};}}
  }%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Definition}~\thedefinition:~\color{Maroon}{#1}};}}%
  }%
  \mdfsetup{innertopmargin=10pt,linecolor=DarkOliveGreen,%
            linewidth=1pt,topline=true,%
            frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
  \begin{mdframed}[]\relax%
  }{\end{mdframed}}

\newcommand{\makedefinition}[3]{%
\begin{definition}[#1]\label{#2}%
#3%
\end{definition}%
}

%\crefname{definition}{definition}{definitions} 
%\Crefname{definition}{Definition}{Definitions} 

%-----------------------------------------------------------------------------------

\newcounter{example}
\numberwithin{example}{chapter}
\newenvironment{example}[1][]{%
  \refstepcounter{example}%
  \ifstrempty{#1}%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,rounded corners,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Example}~\theexample};}}
  }%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,rounded corners,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Example}~\theexample:~\color{Maroon}{#1}};}}%
  }%
  \mdfsetup{innertopmargin=10pt,linecolor=DarkOliveGreen,%
            linewidth=1pt,topline=true,%
            frametitleaboveskip=\dimexpr-\ht\strutbox\relax,%
            backgroundcolor=Maroon!10}
  \begin{mdframed}[]\relax%
  }{\end{mdframed}}

%\makeexample{blah blah}{example:foo:1}{
%foo foo.
%}
%
% title, label, text
\newcommand{\makeexample}[3]{%
\begin{example}[#1]\label{#2}%
#3%
\end{example}%
}

%-----------------------------------------------------------------------------------

\newcounter{questionBox}
\numberwithin{questionBox}{chapter}
\newenvironment{questionBox}[1][]{%
  \refstepcounter{questionBox}%
  \ifstrempty{#1}%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,rounded corners,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Question}~\thequestionBox};}}
  }%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,rounded corners,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Question}~\thequestionBox:~\color{Maroon}{#1}};}}%
  }%
  \mdfsetup{innertopmargin=10pt,linecolor=DarkOliveGreen,%
            linewidth=1pt,topline=true,%
            frametitleaboveskip=\dimexpr-\ht\strutbox\relax,%
            backgroundcolor=Maroon!10}
  \begin{mdframed}[]\relax%
  }{\end{mdframed}}

%\makequestion{blah blah}{question:foo:1}{
%foo foo.
%}
%
% title, label, text
\newcommand{\makequestion}[3]{%
\begin{questionBox}[#1]\label{#2}%
#3%
\end{questionBox}%
}

%-----------------------------------------------------------------------------------
\newcounter{algorithmbox}
\numberwithin{algorithmbox}{chapter}
\newenvironment{algorithmbox}[1][]{%
  \refstepcounter{algorithmbox}%
  \ifstrempty{#1}%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Algorithm}~\thealgorithmbox};}}
  }%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Algorithm}~\thealgorithmbox:~\color{Maroon}{#1}};}}%
  }%
  \mdfsetup{innertopmargin=10pt,linecolor=DarkOliveGreen,%
            linewidth=1pt,topline=true,%
            frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
  \begin{mdframed}[]\relax%
  }{\end{mdframed}}

\RequirePackage{algorithmic} % for makealgorithm

\newcommand{\makealgorithm}[3]{%
\begin{algorithmbox}[#1]\label{#2}%
\begin{algorithmic}%
#3%
\end{algorithmic}%
\end{algorithmbox}%
}

%\crefname{algorithmbox}{algorithm}{algorithms} 
%\Crefname{algorithmbox}{Algorithm}{Algorithms} 

%-----------------------------------------------------------------------------------
\newcounter{aside}
\numberwithin{aside}{chapter}
\newenvironment{aside}[1][]{%
  \refstepcounter{aside}%
  \ifstrempty{#1}%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,rounded corners,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Aside}~\theaside};}}
  }%
  {\mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[line width=1pt,anchor=east,rectangle,rounded corners,draw=DarkOliveGreen,fill=white]
    {\strut \color{DarkOliveGreen}{Aside}~\theaside:~\color{Maroon}{#1}};}}%
  }%
  \mdfsetup{innertopmargin=10pt,linecolor=DarkOliveGreen,%
            linewidth=1pt,topline=true,%
            frametitleaboveskip=\dimexpr-\ht\strutbox\relax,%
            backgroundcolor=Maroon!10}
  \begin{mdframed}[]\relax%
  }{\end{mdframed}}

%\makeaside{blah blah}{aside:foo:1}{
%foo foo.
%}
%
% title, label, text
\newcommand{\makeaside}[3]{%
\begin{aside}[#1]\label{#2}%
#3%
\end{aside}%
}


%-------------------------------------------------------------------------------------
